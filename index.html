<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ê±°ì°½ íšŒì¤‘ ê²Œì‹œíŒ</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM (UMD) -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase Compat Library -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { width: 0px; background: transparent; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="bg-[#F4F6F8] text-slate-800 h-screen overflow-hidden selection:bg-[#4A6FA5] selection:text-white">
    <div id="root" class="h-full"></div>

    <script type="text/babel">
        // --- 1. Icons ---
        const Icons = {
            // [NEW] ìš”ì²­í•˜ì‹  íŒŒë€ ì›í˜• ì•„ì´ì½˜ ìŠ¤íƒ€ì¼ ë°˜ì˜
            KingdomHall: ({ className }) => (
                <svg viewBox="0 0 24 24" fill="none" className={className}>
                    <circle cx="12" cy="12" r="12" fill="#4A6FA5"/>
                    <path d="M5 12L12 6L19 12V20H5V12Z" stroke="white" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round"/>
                    <rect x="10" y="16" width="4" height="4" stroke="white" strokeWidth="1.5" />
                    <path d="M10 10V11" stroke="white" strokeWidth="1.5" strokeLinecap="round" />
                    <path d="M11 11L11.5 13L12 11" stroke="white" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
                    <path d="M12.5 11L13 13L13.5 11L14 13L14.5 11" stroke="white" strokeWidth="1.5" strokeLinecap="round" strokeLinejoin="round" />
                </svg>
            ),
            Calendar: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line></svg>,
            FileText: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline><line x1="16" y1="13" x2="8" y2="13"></line><line x1="16" y1="17" x2="8" y2="17"></line><polyline points="10 9 9 9 8 9"></polyline></svg>,
            Image: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect><circle cx="8.5" cy="8.5" r="1.5"></circle><polyline points="21 15 16 10 5 21"></polyline></svg>,
            Lock: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>,
            Plus: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>,
            X: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>,
            Trash2: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path><line x1="10" y1="11" x2="10" y2="17"></line><line x1="14" y1="11" x2="14" y2="17"></line></svg>,
            Edit2: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z"></path></svg>,
            CheckCircle: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>,
            ChevronRight: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="9 18 15 12 9 6"></polyline></svg>,
            Pin: ({ className, fill }) => <svg viewBox="0 0 24 24" fill={fill || "none"} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><line x1="12" y1="17" x2="12" y2="22"></line><path d="M5 17h14v-1.76a2 2 0 0 0-1.11-1.79l-1.78-.9A2 2 0 0 1 15 10.76V6h1a2 2 0 0 0 0-4H8a2 2 0 0 0 0 4h1v4.76a2 2 0 0 1-1.11 1.79l-1.78.9A2 2 0 0 0 5 15.24Z"></path></svg>,
            Shield: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path></svg>,
            Users: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>,
            Download: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="7 10 12 15 17 10"></polyline><line x1="12" y1="15" x2="12" y2="3"></line></svg>,
            Maximize2: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" y1="3" x2="14" y2="10"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>,
            Minimize2: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="4 14 10 14 10 20"></polyline><polyline points="20 10 14 10 14 4"></polyline><line x1="14" y1="10" x2="21" y2="3"></line><line x1="3" y1="21" x2="10" y2="14"></line></svg>,
            AlertTriangle: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>,
            Upload: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>,
            Save: ({ className }) => <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
        };

        // --- 2. Configuration & Logic ---
        
        const firebaseConfig = {
            apiKey: "AIzaSyAtOwsAO19kLCAzxWvnijtwkPjQh1LXxgk",
            authDomain: "dashboard-9d8e7.firebaseapp.com",
            projectId: "dashboard-9d8e7",
            storageBucket: "dashboard-9d8e7.firebasestorage.app",
            messagingSenderId: "589082334454",
            appId: "1:589082334454:web:e17088c9140d3004e308d7",
            measurementId: "G-0Y23X0L4Z8"
        };
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'senior-friendly-board';

        let app, auth, db;
        try {
            if (!firebase.apps.length) {
                app = firebase.initializeApp(firebaseConfig);
            } else {
                app = firebase.app();
            }
            auth = firebase.auth();
            db = firebase.firestore();
        } catch (e) {
            console.error("Firebase Init Error:", e);
        }

        // Utils
        const compressImage = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = (event) => {
                    const img = new Image();
                    img.src = event.target.result;
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        const MAX_WIDTH = 800; 
                        const scaleSize = MAX_WIDTH / img.width;
                        const finalScale = scaleSize < 1 ? scaleSize : 1;
                        canvas.width = img.width * finalScale;
                        canvas.height = img.height * finalScale;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
                        resolve(canvas.toDataURL('image/jpeg', 0.6));
                    };
                    img.onerror = reject;
                };
                reader.onerror = reject;
            });
        };

        const readFileAsBase64 = (file) => {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
            });
        };

        const getDayName = (date) => {
            const days = ['(ì¼)', '(ì›”)', '(í™”)', '(ìˆ˜)', '(ëª©)', '(ê¸ˆ)', '(í† )'];
            return days[date.getDay()];
        }

        const formatDateFriendly = (dateStr) => {
            if (!dateStr) return '';
            const date = new Date(dateStr);
            return `${date.getFullYear()}. ${String(date.getMonth() + 1).padStart(2, '0')}. ${String(date.getDate()).padStart(2, '0')} ${getDayName(date)}`;
        };

        function App() {
            const [user, setUser] = React.useState(null);
            const [documents, setDocuments] = React.useState([]);
            const [events, setEvents] = React.useState([]);
            const [loginState, setLoginState] = React.useState('logged_out');
            const [passwordInput, setPasswordInput] = React.useState('');
            const [loginError, setLoginError] = React.useState('');
            const [activeDoc, setActiveDoc] = React.useState(null);
            const [viewMode, setViewMode] = React.useState('normal');
            const [isMobile, setIsMobile] = React.useState(false);
            const [currentTime, setCurrentTime] = React.useState('');
            const [isEditMode, setIsEditMode] = React.useState(false);
            const [editTab, setEditTab] = React.useState('notice');
            const [editingDoc, setEditingDoc] = React.useState(null);
            const [editingEvent, setEditingEvent] = React.useState(null);
            const [isProcessing, setIsProcessing] = React.useState(false);
            const [showAllEvents, setShowAllEvents] = React.useState(false);

            React.useEffect(() => {
                if(!auth) return;
                const initAuth = async () => {
                    try {
                        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                            await auth.signInWithCustomToken(__initial_auth_token);
                        } else {
                            await auth.signInAnonymously();
                        }
                    } catch (e) {
                        try { await auth.signInAnonymously(); } catch (anonErr) { console.error(anonErr); }
                    }
                };
                initAuth();
                const unsub = auth.onAuthStateChanged(u => setUser(u));
                const timer = setInterval(() => {
                    const now = new Date();
                    setCurrentTime(`${now.getMonth() + 1}ì›” ${now.getDate()}ì¼`);
                }, 1000);
                const checkMobile = () => setIsMobile(window.innerWidth < 768);
                checkMobile();
                window.addEventListener('resize', checkMobile);
                return () => { unsub(); clearInterval(timer); window.removeEventListener('resize', checkMobile); };
            }, []);

            React.useEffect(() => {
                if (!user || !db || loginState === 'logged_out') {
                    setDocuments([]);
                    setEvents([]);
                    return; 
                }

                const noticeRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('notice_board');
                const unsubNotice = noticeRef.onSnapshot(snapshot => {
                    let docs = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                    docs = docs.filter(d => !d.isDeleted);
                    if (loginState === 'publisher') {
                        docs = docs.filter(doc => doc.targetAudience !== 'elder');
                    }
                    docs.sort((a, b) => {
                        if (!!a.isPinned !== !!b.isPinned) return a.isPinned ? -1 : 1;
                        return (b.createdAt?.seconds || 0) - (a.createdAt?.seconds || 0);
                    });
                    setDocuments(docs);
                });

                const schedRef = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('schedule_board');
                const unsubSched = schedRef.onSnapshot(snapshot => {
                    let evts = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                    evts = evts.filter(e => !e.isDeleted);
                    evts.sort((a, b) => new Date(a.date) - new Date(b.date));
                    const today = new Date().toISOString().split('T')[0];
                    evts = evts.filter(e => (e.endDate || e.date) >= today); 
                    setEvents(evts);
                });
                return () => { unsubNotice(); unsubSched(); };
            }, [user, loginState]);

            const handleLogin = (e) => {
                e.preventDefault();
                if (passwordInput === '1935') { setLoginState('publisher'); setLoginError(''); }
                else if (passwordInput === '00191400') { setLoginState('elder'); setLoginError(''); }
                else if (passwordInput === 'givemecourage') { setLoginState('admin'); setLoginError(''); }
                else { setLoginError('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.'); setPasswordInput(''); }
            };

            // [ê°•ì œ ì‚­ì œ ë¡œì§ ì ìš©]
            const handleDelete = (e, docId, collectionName) => {
                e.preventDefault();
                e.stopPropagation(); // ì´ë²¤íŠ¸ ì „íŒŒ ì¤‘ë‹¨
                
                if (!confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
                
                // 1. í™”ë©´ì—ì„œ ì¦‰ì‹œ ì œê±° (Optimistic UI)
                if (collectionName === 'notice_board') {
                    setDocuments(prev => prev.filter(d => d.id !== docId));
                } else {
                    setEvents(prev => prev.filter(e => e.id !== docId));
                }
                
                // 2. ì„œë²„ì— ë¹„ë™ê¸° ìš”ì²­ (ê²°ê³¼ ê¸°ë‹¤ë¦¬ì§€ ì•ŠìŒ)
                db.collection('artifacts').doc(appId).collection('public').doc('data').collection(collectionName).doc(docId).delete()
                    .catch(() => {
                        // ê¶Œí•œ ë¬¸ì œë¡œ ì‚­ì œ ì‹¤íŒ¨ ì‹œ Soft Delete ì‹œë„
                        db.collection('artifacts').doc(appId).collection('public').doc('data').collection(collectionName).doc(docId).update({ isDeleted: true });
                    });

                if (collectionName === 'notice_board' && activeDoc?.id === docId) setActiveDoc(null);
            };

            const handleTogglePin = async (e, docData) => {
                e.stopPropagation();
                try {
                    await db.collection('artifacts').doc(appId).collection('public').doc('data').collection('notice_board').doc(docData.id).update({
                        isPinned: !docData.isPinned
                    });
                } catch (err) { alert('ê³ ì • ì‹¤íŒ¨'); }
            };

            const handleFileChange = async (e) => {
                const file = e.target.files[0];
                if (!file) return;
                if (file.size > 10 * 1024 * 1024) { alert('10MB ì´í•˜ íŒŒì¼ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.'); return; }
                setIsProcessing(true);
                try {
                    let url = "", type = "image";
                    if (file.type.includes('image')) {
                        url = await compressImage(file);
                    } else {
                        if (file.size > 1.5 * 1024 * 1024) { alert('PDFëŠ” 1.5MB ì´í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.'); setIsProcessing(false); return; }
                        url = await readFileAsBase64(file);
                        type = "pdf";
                    }
                    setEditingDoc(p => ({ ...p, url, type, fileName: file.name, title: p.title || file.name.replace(/\.[^/.]+$/, "") }));
                } catch (err) { alert('íŒŒì¼ ì²˜ë¦¬ ì˜¤ë¥˜'); } finally { setIsProcessing(false); }
            };

            const handleSave = async (e) => {
                e.preventDefault();
                setIsProcessing(true);
                try {
                    if (editTab === 'notice') {
                        if (!editingDoc.title || !editingDoc.url || !editingDoc.targetAudience) {
                            alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'); setIsProcessing(false); return;
                        }
                        const col = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('notice_board');
                        const data = { ...editingDoc, isDeleted: false, updatedAt: firebase.firestore.FieldValue.serverTimestamp() };
                        if (editingDoc.id) await col.doc(editingDoc.id).update(data);
                        else await col.add({ ...data, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                    } else {
                        if (!editingEvent.title || !editingEvent.date) {
                            alert('í•„ìˆ˜ í•­ëª©ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.'); setIsProcessing(false); return;
                        }
                        const col = db.collection('artifacts').doc(appId).collection('public').doc('data').collection('schedule_board');
                        const finalEndDate = (!editingEvent.endDate || editingEvent.endDate === editingEvent.date) ? null : editingEvent.endDate;
                        const data = { ...editingEvent, endDate: finalEndDate, isDeleted: false, updatedAt: firebase.firestore.FieldValue.serverTimestamp() };
                        await col.add({ ...data, createdAt: firebase.firestore.FieldValue.serverTimestamp() });
                    }
                    setIsEditMode(false); setEditingDoc(null); setEditingEvent(null);
                } catch (err) {
                    if(err.message.includes("larger than")) alert("íŒŒì¼ ìš©ëŸ‰ì´ ë„ˆë¬´ í½ë‹ˆë‹¤.");
                    else alert('ì €ì¥ ì‹¤íŒ¨: ' + err.message);
                } finally { setIsProcessing(false); }
            };

            const eventLimit = loginState === 'admin' ? 5 : 3;

            if (loginState === 'logged_out') {
                return (
                    <div className="min-h-screen flex items-center justify-center p-6 bg-[#F0F2F5]">
                        <div className="bg-white rounded-3xl shadow-xl w-full max-w-sm overflow-hidden p-8 flex flex-col items-center">
                            <div className="text-[#4A6FA5] mb-6">
                                <Icons.KingdomHall className="w-24 h-24" />
                            </div>
                            <h2 className="text-2xl font-bold text-[#2C3E50] mb-2">ê±°ì°½ íšŒì¤‘ ê²Œì‹œíŒ</h2>
                            <p className="text-sm text-slate-500 font-medium mb-8">- ê³„íší‘œ ë° ì¼ì • í™•ì¸ -</p>
                            <form onSubmit={handleLogin} className="w-full space-y-4">
                                <input type="password" inputMode="numeric" value={passwordInput} onChange={(e) => setPasswordInput(e.target.value)} placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥" className="w-full bg-slate-50 border-2 border-slate-100 rounded-xl px-4 py-3.5 text-center text-lg font-bold text-slate-700 focus:border-[#4A6FA5] focus:bg-white outline-none transition-all" autoFocus />
                                {loginError && <div className="text-red-500 text-xs font-bold text-center bg-red-50 py-2 rounded-lg">{loginError}</div>}
                                <button type="submit" className="w-full bg-[#4A6FA5] hover:bg-[#3B5B8C] text-white py-3.5 rounded-xl font-bold text-lg shadow-lg shadow-blue-100 transition-all active:scale-95">ì‹œì‘</button>
                            </form>
                            <div className="mt-8 flex items-center gap-2 text-xs text-slate-400 font-medium">
                                <Icons.Lock className="w-3 h-3" /> ê´€ë¦¬ìë¡œë¶€í„° ë°›ì€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”
                            </div>
                        </div>
                    </div>
                );
            }

            return (
                <div className="h-full flex flex-col font-sans">
                    <header className="bg-white border-b border-slate-200 shrink-0 z-20 sticky top-0 safe-top">
                        <div className="px-5 py-4 flex justify-between items-center max-w-6xl mx-auto">
                            <div className="flex items-center gap-3">
                                <div className="text-[#4A6FA5]">
                                    <Icons.KingdomHall className="w-10 h-10" />
                                </div>
                                <div className="flex flex-col">
                                    <h1 className="text-xl font-extrabold text-[#2C3E50] leading-none">ê²Œì‹œíŒ</h1>
                                    <div className="flex gap-1 mt-1">
                                        {loginState === 'admin' && <span className="text-[10px] font-bold bg-red-100 text-red-600 px-2 py-0.5 rounded-full">ê´€ë¦¬ì</span>}
                                        {loginState === 'elder' && <span className="text-[10px] font-bold bg-purple-100 text-purple-600 px-2 py-0.5 rounded-full">ì¥ë¡œ</span>}
                                        {loginState === 'publisher' && <span className="text-[10px] font-bold bg-slate-100 text-slate-600 px-2 py-0.5 rounded-full">ì „ë„ì¸</span>}
                                    </div>
                                </div>
                            </div>
                            <div className="flex items-center gap-3">
                                <span className="text-sm font-bold text-slate-500 hidden sm:block bg-slate-100 px-3 py-1.5 rounded-lg">{currentTime}</span>
                                <button onClick={() => setLoginState('logged_out')} className="text-sm font-bold text-slate-500 hover:text-[#4A6FA5] border border-slate-200 px-3 py-2 rounded-lg transition-colors">ë‚˜ê°€ê¸°</button>
                            </div>
                        </div>
                    </header>

                    <main className="flex-1 overflow-y-auto p-4 md:p-6 space-y-6 max-w-6xl mx-auto w-full pb-24 safe-bottom">
                        
                        <section className="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                            <div className="px-5 py-4 border-b border-slate-100 flex justify-between items-center bg-slate-50/50">
                                <h2 className="text-lg font-extrabold text-[#2C3E50] flex items-center gap-2">
                                    <Icons.Calendar className="w-5 h-5 text-[#4A6FA5]" /> ì˜ˆì •ëœ ì´ë²¤íŠ¸
                                </h2>
                                {events.length > eventLimit && (
                                    <button onClick={() => setShowAllEvents(true)} className="text-sm font-bold text-slate-500 hover:text-[#4A6FA5] flex items-center gap-1">
                                        ë”ë³´ê¸° <Icons.ChevronRight className="w-4 h-4" />
                                    </button>
                                )}
                            </div>
                            <div className="p-0 divide-y divide-slate-100">
                                {events.length === 0 ? (
                                    <div className="py-8 text-center text-slate-400 text-sm">ì˜ˆì •ëœ í–‰ì‚¬ê°€ ì—†ìŠµë‹ˆë‹¤.</div>
                                ) : (
                                    events.slice(0, eventLimit).map(evt => (
                                        <div key={evt.id} className="relative group bg-white hover:bg-slate-50 transition-colors">
                                            <div className="flex flex-row items-center p-5">
                                                <div className="w-[30%] md:w-[20%] border-r-2 border-slate-100 pr-5 flex flex-col justify-center text-right shrink-0">
                                                    <span className="text-sm font-bold text-slate-400 leading-none mb-1">{evt.date.split('-')[0]}</span>
                                                    <span className="text-2xl font-black text-[#4A6FA5] leading-none tracking-tight">{evt.date.split('-')[1]}.{evt.date.split('-')[2]}</span>
                                                    <span className="text-sm font-bold text-slate-500 mt-1">({getDayName(new Date(evt.date))})</span>
                                                    {evt.endDate && evt.endDate !== evt.date && (
                                                        <div className="mt-2 pt-2 border-t border-slate-100 flex flex-col opacity-80">
                                                            <span className="text-[10px] text-slate-400 mb-0.5">~ ì¢…ë£Œ</span>
                                                            <span className="text-lg font-bold text-[#4A6FA5]">{evt.endDate.split('-')[1]}.{evt.endDate.split('-')[2]}</span>
                                                        </div>
                                                    )}
                                                </div>
                                                <div className="flex-1 pl-5 flex flex-col justify-center">
                                                    <div className="flex items-center gap-2 mb-1">
                                                        {evt.date <= new Date().toISOString().split('T')[0] && (!evt.endDate || evt.endDate >= new Date().toISOString().split('T')[0]) && <span className="bg-red-100 text-red-600 text-[10px] px-1.5 py-0.5 rounded font-bold shrink-0">ì˜¤ëŠ˜</span>}
                                                        <h3 className="text-xl font-extrabold text-[#2C3E50] leading-snug">{evt.title}</h3>
                                                    </div>
                                                    {evt.desc && <p className="text-sm text-slate-600 leading-relaxed font-medium">{evt.desc}</p>}
                                                </div>
                                            </div>
                                            {loginState === 'admin' && (
                                                <button onClick={(e) => handleDelete(e, evt.id, 'schedule_board')} className="absolute top-4 right-4 p-3 bg-white shadow border border-slate-100 text-slate-400 hover:text-red-500 rounded-full z-50 cursor-pointer"><Icons.Trash2 className="w-5 h-5" /></button>
                                            )}
                                        </div>
                                    ))
                                )}
                            </div>
                        </section>

                        <section>
                            <div className="mb-4 flex items-center gap-2 px-1">
                                <Icons.FileText className="w-5 h-5 text-[#4A6FA5]" />
                                <h2 className="text-lg font-extrabold text-[#2C3E50]">ê²Œì‹œíŒ</h2>
                            </div>
                            {documents.length === 0 ? (
                                <div className="py-16 text-center text-slate-400 bg-white rounded-2xl border border-slate-200 border-dashed"><p>ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p></div>
                            ) : (
                                <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3 md:gap-5">
                                    {documents.map(doc => (
                                        <div key={doc.id} onClick={() => { setActiveDoc(doc); setViewMode('normal'); }} 
                                            className={`relative bg-white rounded-xl overflow-hidden border shadow-sm cursor-pointer active:scale-95 transition-transform ${activeDoc?.id === doc.id ? 'ring-2 ring-[#4A6FA5]' : 'border-slate-100'} ${doc.isPinned ? 'ring-1 ring-[#4A6FA5]/30' : ''}`}>
                                            <div className="aspect-[16/9] bg-slate-100 relative">
                                                {doc.type === 'pdf' ? (
                                                    <div className="w-full h-full flex flex-col items-center justify-center text-[#4A6FA5]"><Icons.FileText className="w-8 h-8" /><span className="mt-1 text-[10px] font-bold bg-white px-1.5 py-0.5 rounded shadow-sm">PDF</span></div>
                                                ) : (
                                                    <img src={doc.url} className="w-full h-full object-cover" loading="lazy" />
                                                )}
                                                <div className="absolute top-2 left-2 bg-white/90 backdrop-blur-md px-1.5 py-0.5 rounded-md text-[9px] font-bold shadow-sm text-slate-700 flex items-center gap-1"><span className="w-1 h-1 rounded-full bg-[#6B8E23]" />{doc.date}</div>
                                                {doc.targetAudience === 'elder' && <div className="absolute top-2 right-2 bg-purple-600 text-white px-1.5 py-0.5 rounded-md text-[9px] font-bold shadow-md z-10 flex gap-0.5"><Icons.Shield className="w-3 h-3" /> ì¥ë¡œ</div>}
                                                {doc.isPinned && doc.targetAudience !== 'elder' && <div className="absolute top-2 right-2 bg-[#4A6FA5] text-white p-1 rounded-full shadow-lg z-10"><Icons.Pin className="w-3 h-3" fill="currentColor" /></div>}
                                            </div>
                                            <div className={`p-3 ${doc.isPinned ? 'bg-blue-50/20' : ''}`}>
                                                <div className="flex items-center gap-1 mb-1">{doc.isPinned && <span className="text-[9px] font-bold bg-[#4A6FA5] text-white px-1 py-0.5 rounded shrink-0">ê³µì§€</span>}<h3 className="text-sm font-bold text-[#2C3E50] leading-tight truncate">{doc.title}</h3></div>
                                            </div>
                                            {loginState === 'admin' && (
                                                <div className="absolute top-1 right-1 flex gap-1 bg-black/10 p-1 rounded-lg backdrop-blur-sm z-30" onClick={(e) => e.stopPropagation()}>
                                                    <button onClick={(e) => handleTogglePin(e, doc)} className={`p-2 rounded bg-white shadow-sm ${doc.isPinned ? 'text-[#4A6FA5]' : 'text-slate-500'}`}><Icons.Pin className="w-5 h-5" fill={doc.isPinned ? "currentColor" : "none"} /></button>
                                                    <button onClick={(e) => { e.stopPropagation(); setEditingDoc(doc); setEditTab('notice'); setIsEditMode(true); }} className="p-2 rounded bg-white shadow-sm text-slate-500 hover:text-[#4A6FA5]"><Icons.Edit2 className="w-5 h-5" /></button>
                                                    <button onClick={(e) => handleDelete(e, doc.id, 'notice_board')} className="p-2 rounded bg-white shadow-sm text-slate-500 hover:text-red-500"><Icons.Trash2 className="w-5 h-5" /></button>
                                                </div>
                                            )}
                                        </div>
                                    ))}
                                </div>
                            )}
                        </section>
                    </main>

                    {loginState === 'admin' && (
                        <button onClick={() => { 
                            const today = new Date().toISOString().split('T')[0];
                            setEditingDoc({ title: '', type: 'image', desc: '', url: '', fileName: '', date: today, targetAudience: null });
                            setEditingEvent({ title: '', date: today, endDate: today, desc: '' });
                            setIsEditMode(true); setEditTab('notice'); 
                        }} className="fixed bottom-6 right-6 z-30 bg-[#2C3E50] text-white p-4 rounded-full shadow-xl hover:scale-105 active:scale-95 transition-transform"><Icons.Plus className="w-7 h-7" /></button>
                    )}

                    {isEditMode && (
                        <div className="fixed inset-0 bg-slate-900/60 z-[60] flex items-center justify-center p-4 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]">
                                <div className="flex border-b border-slate-100 bg-white">
                                    <button onClick={() => setEditTab('notice')} className={`flex-1 py-5 text-base font-bold flex items-center justify-center gap-2 ${editTab === 'notice' ? 'text-[#4A6FA5] border-b-4 border-[#4A6FA5] bg-blue-50/20' : 'text-slate-400'}`}><Icons.Image className="w-5 h-5" /> ê²Œì‹œë¬¼</button>
                                    <button onClick={() => setEditTab('event')} className={`flex-1 py-5 text-base font-bold flex items-center justify-center gap-2 ${editTab === 'event' ? 'text-[#4A6FA5] border-b-4 border-[#4A6FA5] bg-blue-50/20' : 'text-slate-400'}`}><Icons.Calendar className="w-5 h-5" /> ì¼ì •</button>
                                </div>
                                <div className="p-6 overflow-y-auto">
                                    <form onSubmit={handleSave} className="space-y-6">
                                        {editTab === 'notice' ? (
                                            <>
                                                <div className="bg-slate-50 p-5 rounded-2xl border border-slate-200">
                                                    <label className="block text-base font-bold text-[#2C3E50] mb-3 flex items-center gap-2"><Icons.Users className="w-5 h-5" /> ê³µê°œ ëŒ€ìƒ <span className="text-red-500">*</span></label>
                                                    <div className="grid grid-cols-2 gap-3">
                                                        <button type="button" onClick={() => setEditingDoc({...editingDoc, targetAudience: 'public'})} className={`p-4 rounded-xl text-base font-bold flex flex-col items-center gap-1 transition-all ${editingDoc.targetAudience === 'public' ? 'bg-white border-2 border-[#4A6FA5] text-[#4A6FA5] shadow-sm' : 'bg-white border border-slate-200 text-slate-400'}`}><Icons.Users className="w-6 h-6" /> ì „ë„ì¸</button>
                                                        <button type="button" onClick={() => setEditingDoc({...editingDoc, targetAudience: 'elder'})} className={`p-4 rounded-xl text-base font-bold flex flex-col items-center gap-1 transition-all ${editingDoc.targetAudience === 'elder' ? 'bg-white border-2 border-purple-600 text-purple-600 shadow-sm' : 'bg-white border border-slate-200 text-slate-400'}`}><Icons.Shield className="w-6 h-6" /> ì¥ë¡œ ì „ìš©</button>
                                                    </div>
                                                    <p className="text-sm text-slate-500 mt-3 text-center leading-relaxed">
                                                        {editingDoc.targetAudience === 'public' && "âœ… ëª¨ë“  í˜•ì œ ìë§¤ê°€ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
                                                        {editingDoc.targetAudience === 'elder' && "ğŸ”’ ì¥ë¡œì™€ ê´€ë¦¬ìë§Œ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤."}
                                                        {!editingDoc.targetAudience && "âš ï¸ ìœ„ ì˜µì…˜ ì¤‘ í•˜ë‚˜ë¥¼ ë°˜ë“œì‹œ ì„ íƒí•´ì£¼ì„¸ìš”."}
                                                    </p>
                                                </div>
                                                <div className="relative">
                                                    <input type="file" accept="image/*,application/pdf" onChange={handleFileChange} disabled={isProcessing} className="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10" />
                                                    <div className={`border-2 border-dashed rounded-xl p-8 flex flex-col items-center justify-center ${editingDoc.url ? 'border-[#4A6FA5] bg-blue-50/30' : 'border-slate-300 bg-slate-50'}`}>
                                                        {isProcessing ? <div className="text-[#4A6FA5] font-bold text-base">ì²˜ë¦¬ ì¤‘...</div> : editingDoc.url ? <div className="text-green-600 font-bold text-base flex items-center gap-2"><Icons.CheckCircle className="w-5 h-5" /> íŒŒì¼ ì„ íƒ ì™„ë£Œ</div> : <div className="text-slate-400 text-base flex flex-col items-center font-bold"><Icons.Upload className="w-8 h-8 mb-2" /> íŒŒì¼ ì„ íƒ (í„°ì¹˜)</div>}
                                                    </div>
                                                </div>
                                                <div className="space-y-1"><label className="text-sm font-bold text-slate-500 ml-1">ì œëª©</label><input type="text" required value={editingDoc.title} onChange={(e) => setEditingDoc({...editingDoc, title: e.target.value})} className="w-full px-4 py-4 bg-slate-50 border-none rounded-xl text-lg font-bold text-[#2C3E50] outline-none" placeholder="ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" /></div>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div className="space-y-1"><label className="text-sm font-bold text-slate-500 ml-1">ë‚ ì§œ</label><input type="date" required value={editingDoc.date} onChange={(e) => setEditingDoc({...editingDoc, date: e.target.value})} className="w-full px-4 py-4 bg-slate-50 border-none rounded-xl text-base font-bold text-[#2C3E50] outline-none" /></div>
                                                    <div className="space-y-1"><label className="text-sm font-bold text-slate-500 ml-1">ì„¤ëª…</label><input type="text" value={editingDoc.desc} onChange={(e) => setEditingDoc({...editingDoc, desc: e.target.value})} className="w-full px-4 py-4 bg-slate-50 border-none rounded-xl text-base text-[#2C3E50] outline-none" placeholder="ì„ íƒ ì‚¬í•­" /></div>
                                                </div>
                                            </>
                                        ) : (
                                            <>
                                                <div className="bg-blue-50 p-5 rounded-xl border border-blue-100 flex items-start gap-4">
                                                    <Icons.Calendar className="w-6 h-6 text-[#4A6FA5] shrink-0 mt-1" />
                                                    <div><h4 className="text-base font-bold text-[#4A6FA5]">ìƒˆë¡œìš´ ì¼ì • ì¶”ê°€</h4><p className="text-sm text-slate-500 mt-1 leading-snug">ìˆœíšŒ ëŒ€íšŒ, ê¸°ë…ì‹ ë“± ì£¼ìš” í–‰ì‚¬ë¥¼ ì…ë ¥í•˜ì„¸ìš”. ğŸ—“ï¸</p></div>
                                                </div>
                                                <div className="space-y-1"><label className="text-sm font-bold text-slate-500 ml-1">í–‰ì‚¬ëª…</label><input type="text" required value={editingEvent.title} onChange={(e) => setEditingEvent({...editingEvent, title: e.target.value})} className="w-full px-4 py-4 bg-slate-50 border-none rounded-xl text-xl font-bold text-[#4A6FA5] outline-none" placeholder="ì˜ˆ: ìˆœíšŒ ëŒ€íšŒ" /></div>
                                                <div className="grid grid-cols-2 gap-4">
                                                    <div className="space-y-1"><label className="text-sm font-bold text-slate-500 ml-1">ì‹œì‘ì¼</label><input type="date" required value={editingEvent.date} onChange={(e) => setEditingEvent({...editingEvent, date: e.target.value, endDate: e.target.value > editingEvent.endDate ? e.target.value : editingEvent.endDate})} className="w-full px-4 py-4 bg-slate-50 border-none rounded-xl text-base font-bold text-slate-800 outline-none" /></div>
                                                    <div className="space-y-1"><label className="text-sm font-bold text-slate-500 ml-1">ì¢…ë£Œì¼</label><input type="date" required value={editingEvent.endDate || editingEvent.date} onChange={(e) => setEditingEvent({...editingEvent, endDate: e.target.value})} className="w-full px-4 py-4 bg-slate-50 border-none rounded-xl text-base font-bold text-slate-800 outline-none" /></div>
                                                </div>
                                                <div className="space-y-1"><label className="text-sm font-bold text-slate-500 ml-1">ì¶”ê°€ ì •ë³´</label><input type="text" value={editingEvent.desc} onChange={(e) => setEditingEvent({...editingEvent, desc: e.target.value})} className="w-full px-4 py-4 bg-slate-50 border-none rounded-xl text-base text-slate-700 outline-none" placeholder="ì¥ì†Œ ë“± ì¶”ê°€ ì •ë³´ (ì„ íƒ)" /></div>
                                            </>
                                        )}
                                        <button type="submit" disabled={isProcessing || (editTab === 'notice' && !editingDoc.targetAudience)} className="w-full py-5 rounded-xl font-bold text-xl bg-[#2C3E50] text-white hover:bg-[#1a252f] disabled:bg-slate-300 transition-colors flex items-center justify-center gap-2 mt-4 shadow-lg"><Icons.Save className="w-6 h-6" /> ë“±ë¡í•˜ê¸°</button>
                                    </form>
                                </div>
                                <button onClick={() => setIsEditMode(false)} className="absolute top-3 right-3 p-3 bg-slate-100 rounded-full text-slate-500"><Icons.X className="w-6 h-6" /></button>
                            </div>
                        </div>
                    )}
                    {showAllEvents && (
                        <div className="fixed inset-0 bg-slate-900/60 z-[70] flex items-center justify-center p-4 backdrop-blur-sm">
                            <div className="bg-white w-full max-w-md rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[80vh]">
                                <div className="px-6 py-4 border-b border-slate-100 flex justify-between items-center shrink-0"><h3 className="font-extrabold text-lg text-[#2C3E50]">ì „ì²´ ì¼ì •</h3><button onClick={() => setShowAllEvents(false)} className="p-2 bg-slate-100 rounded-full"><Icons.X className="w-5 h-5" /></button></div>
                                <div className="overflow-y-auto p-4 space-y-2">
                                    {events.map(evt => (
                                        <div key={evt.id} className="p-4 bg-slate-50 rounded-xl border border-slate-100"><div className="text-xs font-bold text-slate-500 mb-1">{formatEventDate(evt.date, evt.endDate)}</div><h4 className="text-base font-bold text-[#4A6FA5]">{evt.title}</h4>{evt.desc && <p className="text-xs text-slate-600 mt-1">{evt.desc}</p>}</div>
                                    ))}
                                </div>
                            </div>
                        </div>
                    )}
                    {activeDoc && (
                        <div className={`fixed z-50 bg-white shadow-2xl border border-slate-200 overflow-hidden flex flex-col transition-all duration-300 ease-out ${viewMode === 'minimized' ? (isMobile ? 'bottom-0 left-0 right-0 h-16 rounded-t-2xl border-t-2 border-[#4A6FA5]' : 'bottom-6 right-6 w-80 h-16 rounded-xl border-2') : (isMobile ? 'bottom-0 left-0 right-0 h-[92vh] rounded-t-2xl shadow-[0_-10px_40px_-10px_rgba(0,0,0,0.3)]' : 'bottom-8 right-8 w-[600px] h-[85vh] rounded-2xl')}`}>
                            <div className="flex items-center justify-between px-4 py-3 bg-white border-b border-slate-100 cursor-pointer" onClick={() => setViewMode(viewMode === 'minimized' ? 'normal' : 'minimized')}><div className="flex items-center gap-3 overflow-hidden"><div className="bg-[#4A6FA5] p-1.5 rounded-lg text-white shrink-0">{activeDoc.type === 'pdf' ? <Icons.FileText className="w-4 h-4" /> : <Icons.Image className="w-4 h-4" />}</div><h3 className="font-bold text-[#2C3E50] text-sm truncate">{activeDoc.title}</h3></div><div className="flex items-center gap-1 text-slate-400"><button onClick={(e) => { e.stopPropagation(); setViewMode(viewMode === 'fullscreen' ? 'normal' : 'fullscreen'); }} className="p-2 hover:bg-slate-100 rounded-lg hidden md:block">{viewMode === 'fullscreen' ? <Icons.Minimize2 className="w-4 h-4" /> : <Icons.Maximize2 className="w-4 h-4" />}</button><button onClick={(e) => { e.stopPropagation(); setActiveDoc(null); }} className="p-2 bg-slate-100 hover:bg-red-50 hover:text-red-500 rounded-lg text-slate-500"><Icons.X className="w-4 h-4" /></button></div></div>
                            <div className={`flex-1 bg-slate-50 relative overflow-hidden flex flex-col ${viewMode === 'minimized' ? 'hidden' : 'block'}`}><div className="flex-1 overflow-auto flex items-center justify-center p-4">{activeDoc.type === 'pdf' ? (<object data={activeDoc.url} type="application/pdf" className="w-full h-full min-h-[50vh] bg-white rounded shadow-sm border border-slate-200"><div className="flex flex-col items-center justify-center h-full text-center p-6"><Icons.FileText className="w-12 h-12 text-[#4A6FA5] mb-2" /><p className="text-sm font-bold mb-4">ë¯¸ë¦¬ë³´ê¸° ì œí•œ</p><a href={activeDoc.url} download={activeDoc.fileName} className="bg-[#4A6FA5] text-white px-4 py-2 rounded-lg text-sm font-bold flex items-center gap-2"><Icons.Download className="w-4 h-4" /> ë‹¤ìš´ë¡œë“œ</a></div></object>) : (<img src={activeDoc.url} className="max-w-full max-h-full object-contain rounded shadow-lg" />)}</div><div className="bg-white border-t border-slate-200 p-3 flex justify-between items-center shrink-0"><span className="text-xs font-bold text-slate-500 truncate max-w-[150px]">{activeDoc.fileName}</span><a href={activeDoc.url} download={activeDoc.fileName || "download"} className="flex items-center gap-2 bg-[#F0F2F5] text-[#2C3E50] px-3 py-2 rounded-lg font-bold hover:bg-slate-200 transition-colors text-xs"><Icons.Download className="w-4 h-4" /> ì €ì¥í•˜ê¸°</a></div></div>
                        </div>
                    )}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
